<!DOCTYPE html>
<html>
  <head>
    <title>VideoJS Annotated Comments Test Page</title>
    <link href="/video.js/dist/video-js.css" rel="stylesheet" />
    <link href="assets/videojs_skin.css" rel="stylesheet" />
    <link href="assets/page.css" rel="stylesheet" />
    <link href="assets/font-awesome.min.css" rel="stylesheet" />
    <link href="css/annotations.css" rel="stylesheet" />   
    <style>
        @font-face {
            font-family: 'IBMPlex';
            src: url('./fonts/IBM-Plex-Sans-Arabic/IBMPlexSansArabic-Bold.otf');
        }
        @font-face {
            font-family: 'IBMPlexExtraLight';
            src: url('./fonts/IBM-Plex-Sans-Arabic/IBMPlexSansArabic-ExtraLight.otf');
        }
        @font-face {
            font-family: 'IBMPlexLight';
            src: url('./fonts/IBM-Plex-Sans-Arabic/IBMPlexSansArabic-Light.otf');
        }
        @font-face {
            font-family: 'IBMPlexMedium';
            src: url('./fonts/IBM-Plex-Sans-Arabic/IBMPlexSansArabic-Medium.otf');
        }
        @font-face {
            font-family: 'IBMPlexRegular';
            src: url('./fonts/IBM-Plex-Sans-Arabic/IBMPlexSansArabic-Regular.otf');
        }
        @font-face {
            font-family: 'IBMPlexSemiBold';
            src: url('./fonts/IBM-Plex-Sans-Arabic//IBMPlexSansArabic-SemiBold.otf');
        }
        @font-face {
            font-family: 'IBMPlexText';
            src: url('./fonts/IBM-Plex-Sans-Arabic/IBMPlexSansArabic-Text.otf');
        }
        @font-face {
            font-family: 'IBMPlexThin';
            src: url('./fonts/IBM-Plex-Sans-Arabic/IBMPlexSansArabic-Thin.otf');
        }
    </style>
    <script>
      function guid() {
        function s4() {
          return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
        }
        return (
          s4() +
          s4() +
          "-" +
          s4() +
          "-" +
          s4() +
          "-" +
          s4() +
          "-" +
          s4() +
          s4() +
          s4()
        );
      }
      var annotations = [
        {
          id: guid(),
          range: {
            start: 55,
            end: 60
          },
          shape: {
            x1: 23.47,
            y1: 9.88,
            x2: 60.83,
            y2: 44.2
          },
          comments: [
            {
              id: guid(),
              meta: {
                datetime: "2017-03-28T19:17:32.238Z",
                user_id: 1,
                user_name: "Jack Pope"
              },
              body:
                'Is the "Stories API" the only API we want to highlight here? It makes the system feel a little limited, even though we have robust functionality and multiple APIs'
            }
          ]
        },
        {
          range: {
            start: 65,
            stop: null
          },
          shape: {
            x1: 0.97,
            y1: 65.19,
            x2: 36.25,
            y2: 97.28
          },
          comments: [
            {
              id: "2854a682-ffdf-78a4-796d-22abb6d9cac3",
              meta: {
                datetime: "2017-03-28T19:18:25.485Z",
                user_id: 2,
                user_name: "Evan Carothers"
              },
              body: "Can we replace this logo with Microsoft?"
            },
            {
              id: guid(),
              meta: {
                datetime: "2017-03-29T00:18:25.485Z",
                user_id: 1,
                user_name: "محمود فرح"
              },
              body:
              "النص هنا  النص هنا  النص هنا النص هنا النص هنا النص هنا النص هنا "
            }
          ]
        },
        {
          range: {
            start: 100,
            end: null
          },
          shape: null,
          comments: [
            {
              id: "e0b9787b-fbe7-f1e9-5134-d0eb69a783aa",
              meta: {
                datetime: "2017-03-28T19:21:41.351Z",
                user_id: 1,
                user_name: "محمود فرح"
              },
              body:
              "النص هنا  النص هنا  النص هنا  هنا ",
              
            }
          ]
        },
        {
          range: {
            start: 21,
            end: 61
          },
          shape: null,
          comments: [
            {
              id: "e0b9787b-fbe7-f1e9-5134-d0eb69a783aa",
              meta: {
                datetime: "2017-03-28T19:21:41.351Z",
                user_id: 2,
                user_name: "محمود فرح"
              },
              body:
              "النص هنا  النص هنا  هنا هنا هنا هنا هنا  هنا هنا هنا هنا هنا هنا ",
              test:"محمد علاء",
              reply: [
                  {
                    id: "e0b9787b-fbe7-f1e9-5134-d0eb69a7Ere4aa",
                    meta: {
                        datetime: "2017-03-28T19:21:41.351Z",
                        user_id: 2,
                        user_name: "علي"
                    },   
                    body: "النص هنا  النص هنا  النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا ",
                  },
                  {
                    id: "e0b9787b-fbe7-f1e9-5134-d0eb69a7Ere4aa",
                    meta: {
                        datetime: "2017-03-28T19:21:41.351Z",
                        user_id: 2,
                        user_name: "محمد علاء"
                    },   
                    body: "النص هنا  النص هنا  النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا النص هنا ",
                  },
              ]
            }
          ]
        }
      ];
    </script>
  </head>
  <body>
    <div class="User">
        <form id="submit_form">
            <input type='text' placeholder="ادخل اسم المستخدم"/>
            <input type='submit' value='حفظ'/>
        </form> 

    </div>
    <div id="video_wrap">
      <!-- <div>
        <button onclick="ADD()" style="margin-top:20px">+ ADD VIDEO</button>
      </div> -->
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="/video.js/dist/video.min.js"></script>
    <script src="/videojs-annotation-comments.js"></script>
    <script>
        // Submit Form
        let Username='';
        $('#submit_form').on('submit', (e)=>{
            e.preventDefault();
            console.log(e.target[0].value)
            if(e.target[0].value){
                Username = e.target[0].value;
                playerOptions = { controlBar: { volumePanel: { inline: false } } },
                pluginOptions = {
                annotationsObjects: annotations,
                bindArrowKeys: true,
                meta: {
                    user_id: 2,
                    user_name: e.target[0].value
                },
                showControls: true,
                showCommentList: true,
                showFullScreen: true,
                startInAnnotationMode: false,
                showMarkerShapeAndTooltips: true
                };
                $('.User').addClass('hide-from')
                ADD();
            }
        })
        // End Submit Form 
      //window.VAC_DEBUG = true;    
      function ADD() {
        var id = new Date().getTime();

        var html = '<div id="wrap-' + id + '" class="vwrap">';
        html +=
          '<video id="vid-' +
          id +
          '" class="video-js" controls preload="auto" width="720" height="405" data-setup="{}">';
        html +=
          '<source src="contently-platform-overview.mp4" type="video/mp4"></video>';
        // html +=
        //   '<div><button onclick="REMOVE(' +
        //   id +
        //   ')">- REMOVE VIDEO</button></div>';
        // html += "</div>";

        var $lastVid = $(".vwrap:last");
        if ($lastVid.length) {
          $lastVid.after(html);
        } else {
          $("#video_wrap").prepend(html);
        }

        var player = window.videojs("vid-" + id, playerOptions);

        player.ready(function() {
          var plugin = player.annotationComments(pluginOptions);

          plugin.onReady(function() {
            console.log("PLUGIN IS READY!", id);
          });
          player.muted(true);

          videos.push({
            id: id,
            player: player,
            plugin: plugin
          });
          console.log("::ADDING:: ", videos[videos.length - 1]);
        });
      }

      function REMOVE(id) {
        var video = videos.find(function(v) {
          return v.id == id;
        });
        console.log("::REMOVING:: ", video);
        video.plugin = video.plugin.dispose();
        video.player.dispose();
        $("#wrap-" + video.id).remove();
      }

      // Add initial video
      
    </script>
  </body>
</html>
